<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TPB CATALOG RAW</title>
	<script>

		const urlParams = new URLSearchParams(window.location.search);
		const state = urlParams.get('state');
		const endpoint = "https://56a5-104-245-144-4.ngrok.io/get/products?state="+state;
		fetch(endpoint)
			.then((resp) => resp.json())
			.then((data) => {
				console.log(data);
				data.products.forEach((product)=>{
					let productRow = document.createElement('tr');
					let productRowCell = document.createElement('td');
					productRowCell.textContent = product.title;
					productRowCell.colSpan = 5;
					productRow.appendChild(productRowCell);
					document.querySelector('#catalog tbody').appendChild(productRow);
					product.variants.forEach((variant) => {
						let variantRow = document.createElement('tr');
						['title','sku','inventoryQuantity','taxInclusivePrice_'+state,'unitExciseTax_'+state].forEach((field) => {
							let variantCell = document.createElement('td');
							variantCell.textContent = field.includes('_') ? '$'+variant[field] : variant[field];
							variantRow.appendChild(variantCell);
						})
						document.querySelector('#catalog tbody').appendChild(variantRow);
					});
				});
			})	
			.catch((err) => { console.log(err); })
	</script>
</head>
<body>
	<table id="catalog">
		<thead>
			<th>Title</th>
			<th>SKU</th>
			<th>Inventory</th>
			<th>All-in Price</th>
			<th>Unit Excise Tax</th>
		</thead>
		<tbody></tbody>
	</table>
</body>
</html>